!function(e,t,o){var h={"default":"auto",crosshair:"crosshair",m:"move",l:"w-resize",r:"e-resize",u:"n-resize",d:"s-resize",lu:"nw-resize",ld:"sw-resize",ru:"ne-resize",rd:"se-resize"},a={dragBoxCSS:{},maskEnable:!0,maskCSS:{},dragEnable:!0,previewEnable:!1,previewCSS:{width:200,height:200},fixRatio:!1,whRatio:[2,1],flowEnable:!0,border:5},r=function(){function e(e){for(i=0,l=e.length;i<l;i++)e[i].addClass(c)}function r(i,h){c="jcrop-"+(this.id||parseInt(1e4*Math.random())),m=t(this),b=t("<img>").appendTo(m).attr("src",i),h!=o&&(Y=h,T.previewEnable=!0,g(Y),X.hide()),x=t("<div>").appendTo(m).attr("id","mask_box").addClass("default-mask-box").css(T.maskCSS),e([m,b,x]),t("."+c).unbind(".jcrop"),t("."+c).bind("mousedown.jcrop",j.mousedown),t("."+c).bind("mousemove.jcrop",j.mousemove),t("."+c).bind("mouseup.jcrop",j.mouseup)}function p(e,o,i){t("<div>").appendTo(m).addClass("corner-box").css({left:e-2,top:o-1,cursor:i})}function s(e){var o=[m,v,b,x,X,y];return d(t(e),o)||d(t(e),t(".corner-box"))}function d(e,t){for(var o=0,i=t.length;o<i;o++){t[o];if(e.is(t[o]))return!0}return!1}function n(e,t,o){var i=e,h=t;return T.fixRatio&&(o=o instanceof Array?2==o.length?parseFloat(o[0])/(parseFloat(o[1])||1)||1:parseFloat(o[0])||1:parseFloat(o)||1,e/t<o?(i=t*o,h=t):(h=e/o,i=e)),{w:i,h:h}}function f(e,t,o){if(Y){e="undefined"!=typeof e?e:T.previewCSS.width,t="undefined"!=typeof t?t:T.previewCSS.height,o="undefined"!=typeof o?o:T.whRatio,o=o instanceof Array?2==o.length?parseFloat(o[0])/(parseFloat(o[1])||1)||1:parseFloat(o[0])||1:parseFloat(o)||1;var i=e,h=t;o>=1?(h=e/o,i=e):(i=t*o,h=t),X.css({width:i,height:h})}}function g(e){Y=e,X=t("#"+Y).addClass("default-preview-box").css(T.previewCSS),f(),y=t("<img>").appendTo("#"+Y).attr("id","preview_box").attr("src",image),T.previewEnable||X.hide()}function w(e,t,o){return e<=t&&e>=o||e<=o&&e>=t}function u(){v.remove(),x.remove(),v=null,x=null}var c,b,m,v,x,C,y,X,Y=null,z=!1,k=!1,M={left:0,top:0,width:0,height:0},S={left:0,width:0,top:0,height:0},E=h["default"],_={},D={},j={mousedown:function(e){if(console.log(e.target),s(e.target))return e.preventDefault(),T.dragEnable&&E!=h.crosshair&&E!=h["default"]?(k=!0,D.x=e.pageX,D.y=e.pageY,!1):(T.maskEnable?(x.css({left:b.position().left,top:b.position().top,width:b.width(),height:b.height()}).css("zIndex",5),x.show()):x.hide(),X!=o&&X.hide(),T.previewEnable&&X.show(),v!=o&&(v.remove(),v=null),z=!0,mouseDown_left=e.pageX,mouseDown_top=e.pageY,S.left=mouseDown_left,S.width=0,S.top=mouseDown_top,S.height=0,!1)},mousemove:function(e){if(R.setCornerCursor({x:e.pageX,y:e.pageY},S),z||k){if(z){S.left=mouseDown_left<e.pageX?mouseDown_left:e.pageX,S.width=Math.abs(mouseDown_left-e.pageX),S.top=mouseDown_top<e.pageY?mouseDown_top:e.pageY,S.height=Math.abs(mouseDown_top-e.pageY);var t=n(S.width,S.height,T.whRatio);S.width=t.w,S.height=t.h,R.checkArea(S)}if(k){switch(E){case h.m:_.left=S.left+(e.pageX-D.x),_.top=S.top+(e.pageY-D.y),_.width=S.width,_.height=S.height;break;case h.l:_.left=e.pageX>S.left+S.width?S.left+S.width:e.pageX,_.top=S.top,_.width=Math.abs(e.pageX-(S.left+S.width)),_.height=S.height;break;case h.r:_.left=e.pageX>S.left?S.left:e.pageX,_.top=S.top,_.width=Math.abs(e.pageX-S.left),_.height=S.height;break;case h.u:_.left=S.left,_.top=e.pageY>S.top+S.height?S.top+S.height:e.pageY,_.width=S.width,_.height=Math.abs(e.pageY-(S.top+S.height));break;case h.d:_.left=S.left,_.top=e.pageY>S.top?S.top:e.pageY,_.width=S.width,_.height=Math.abs(e.pageY-S.top);break;case h.lu:_.left=e.pageX>S.left+S.width?S.left+S.width:e.pageX,_.top=e.pageY>S.top+S.height?S.top+S.height:e.pageY,_.width=Math.abs(e.pageX-(S.left+S.width)),_.height=Math.abs(e.pageY-(S.top+S.height));break;case h.ld:_.left=e.pageX>S.left+S.width?S.left+S.width:e.pageX,_.top=e.pageY>S.top?S.top:e.pageY,_.width=Math.abs(e.pageX-(S.left+S.width)),_.height=Math.abs(e.pageY-S.top);break;case h.ru:_.left=e.pageX>S.left?S.left:e.pageX,_.top=e.pageY>S.top+S.height?S.top+S.height:e.pageY,_.width=Math.abs(e.pageX-S.left),_.height=Math.abs(e.pageY-(S.top+S.height));break;case h.rd:_.left=e.pageX>S.left?S.left:e.pageX,_.top=e.pageY>S.top?S.top:e.pageY,_.width=Math.abs(e.pageX-S.left),_.height=Math.abs(e.pageY-S.top)}R.checkArea(_)}if(R.updatedb(),R.updatePreview(),v){var o=b.offset();M={left:v.offset().left-o.left,top:v.offset().top-o.top,width:v.width(),height:v.height()}}else M={left:0,top:0,width:0,height:0}}},mouseup:function(e){z&&(z=!1,v&&0!=v.width()&&0!=v.height()||(x.hide(),X!=o&&X.hide(),v&&(v.remove(),v=null),clearInterval(C))),k&&(k=!1,S.left=_.left,S.top=_.top,S.width=_.width,S.height=_.height,R.setCornerCursor({x:e.pageX,y:e.pageY},S)),R.setCornerBox(v)}},R={checkArea:function(e){var t={left:b.position().left,top:b.position().top,width:b.width(),height:b.height()};e.left>t.left?(e.left+e.width>t.left+t.width&&(e.width=t.left+t.width-e.left),e.left>t.left+t.width&&(e.left=t.left+t.width,e.width=0)):(e.width=e.width-(t.left-e.left),e.left=t.left),e.top>t.top?(e.top+e.height>t.top+t.height&&(e.height=t.top+t.height-e.top),e.top>t.top+t.height&&(e.top=t.top+t.height,e.height=0)):(e.height=e.height-(t.top-e.top),e.top=t.top)},updatedb:function(){var e,o;v&&v.remove(),v=t("<div>").appendTo(m).attr("id","drag_box").addClass("default-drag-box dashed-box").css(T.dragBoxCSS),z&&(e=n(S.width,S.height,T.whRatio),S.width=e.w,S.height=e.h,o=S),k&&(e=n(_.width,_.height,T.whRatio),_.width=e.w,_.height=e.h,o=_),v.css({left:o.left,top:o.top,width:o.width,height:o.height}).css("zIndex",10),R.setCornerBox(v)},updatePreview:function(){if(T.previewEnable){zoom=1,f(),T.fixRatio&&(z&&(zoom=S.width/X.width()),k&&(zoom=_.width/X.width()));var e=b.width()/zoom,t=b.height()/zoom,o=b.position().left,i=b.position().top,h=v.position().left,a=v.position().top,r=(o-h)/zoom,p=(i-a)/zoom;y.css({width:e,height:t,marginLeft:r,marginTop:p})}},setCornerBox:function(e){if(m.children().remove(".corner-box"),e)return T.dragEnable&&(p(e.position().left-T.border/2,e.position().top-T.border/2,h.lu),p(e.position().left+e.width()/2-T.border/2,e.position().top-T.border/2,h.u),p(e.position().left+e.width()-T.border/2,e.position().top-T.border/2,h.ru),p(e.position().left-T.border/2,e.position().top+e.height()/2-T.border/2,h.l),p(e.position().left+e.width()-T.border/2,e.position().top+e.height()/2-T.border/2,h.r),p(e.position().left-T.border/2,e.position().top+e.height()-T.border,h.ld),p(e.position().left+e.width()/2-T.border/2,e.position().top+e.height()-T.border,h.d),p(e.position().left+e.width()-T.border/2,e.position().top+e.height()-T.border,h.rd)),T.flowEnable?void(e.hasClass("dashed-box")&&(e.removeClass("dashed-box"),t("<div>").appendTo(e).addClass("dashed-top").css("top",0),t("<div>").appendTo(e).addClass("dashed-left").css("left",0),t("<div>").appendTo(e).addClass("dashed-bottom").css("top",e.height()-2),t("<div>").appendTo(e).addClass("dashed-right").css("left",e.width()-2),clearInterval(C),C=setInterval(function(){var e=t(".dashed-top").css("left"),o=t(".dashed-bottom").css("left");e=parseInt(e),o=parseInt(o),e<0?e+=2:e=-1400,o>-1e3?o-=2:o=0,t(".dashed-top").css("left",e+"px"),t(".dashed-right").css("top",e+"px"),t(".dashed-bottom").css("left",o+"px"),t(".dashed-left").css("top",o+"px")},60))):(clearInterval(C),e.addClass("dashed-box"),e.remove(".dashed-top"),e.remove(".dashed-left"),e.remove(".dashed-bottom"),void e.remove(".dashed-right"))},setCornerCursor:function(e,t){if(!k){var o=T.border,i=[t.left,t.top,t.left+t.width,t.top+t.height];E=h.crosshair,w(e.x,i[0]+o,i[2]-o)&&w(e.y,i[1]+o,i[3]-o)&&(E=T.dragEnable?h.m:h["default"]),T.dragEnable&&(w(e.x,i[0]-o,i[0]+o)&&w(e.y,i[1]+o,i[3]-o)&&(E=h.l),w(e.x,i[2]+o,i[2]-o)&&w(e.y,i[1]+o,i[3]-o)&&(E=h.r),w(e.x,i[2]-o,i[0]+o)&&w(e.y,i[1]-o,i[1]+o)&&(E=h.u),w(e.x,i[2]-o,i[0]+o)&&w(e.y,i[3]+o,i[3]-o)&&(E=h.d),w(e.x,i[0]-o,i[0]+o)&&w(e.y,i[1]-o,i[1]+o)&&(E=h.lu),w(e.x,i[0]-o,i[0]+o)&&w(e.y,i[3]+o,i[3]-o)&&(E=h.ld),w(e.x,i[2]+o,i[2]-o)&&w(e.y,i[1]-o,i[1]+o)&&(E=h.ru),w(e.x,i[2]+o,i[2]-o)&&w(e.y,i[3]+o,i[3]-o)&&(E=h.rd)),v&&v.css("cursor",E),b.css("cursor",E),x.css("cursor",E)}}},T=t.extend({},a),I={init:r,crop:function(){return M},config:function(e){T=t.extend({},a,e)},setPreDivRect:f,destroy:u,onResize:function(){},onMove:function(){}};return I};t.fn.jCrop=function(e){var o=arguments;return this.each(function(){var i=new r;return i[e]?i[e].apply(this,Array.prototype.slice.call(o,1)):"string"==typeof e?i.init.apply(this,o):"object"==typeof e?i.config.apply(this,o):void t.error("Method "+e+" does not exist on jQuery.jCrop")})}}(this,jQuery);