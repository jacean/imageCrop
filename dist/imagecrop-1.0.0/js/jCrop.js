!function(e){e.jCrop=function(){function e(e,i,a){x=$("#"+e),x.attr("src",i),void 0!=a&&(X=a,A.previewEnable=!0,l(X),S.hide()),x.mousedown(t),x.mousemove(o),y=$("<div>").appendTo("body").attr("id","mask_box").addClass("default-mask-box").css(A.maskCSS),y.mousedown(t),y.mousemove(o),y.css("cursor",E.crosshair),x.css("cursor",E.crosshair),$(window).mouseup(h)}function t(e){return A.maskEnable?(y.css({left:x.position().left,top:x.position().top,width:x.width(),height:x.height()}).css("zIndex",5),y.show()):y.hide(),void 0!=S&&S.hide(),A.previewEnable?S.show():S.hide(),void 0!=b&&(b.remove(),b=null),Y=!0,e.preventDefault(),Y=!0,mouseDown_left=e.pageX,mouseDown_top=e.pageY,_.left=mouseDown_left,_.width=0,_.top=mouseDown_top,_.height=0,!1}function o(e){if(Y){e.preventDefault(),_.left=mouseDown_left<e.pageX?mouseDown_left:e.pageX,_.width=Math.abs(mouseDown_left-e.pageX),_.top=mouseDown_top<e.pageY?mouseDown_top:e.pageY,_.height=Math.abs(mouseDown_top-e.pageY);var t=p(_.width,_.height,A.whRatio);return _.width=t.w,_.height=t.h,s(),A.previewEnable&&d(),!1}}function i(e){return e.preventDefault(),D=!0,I.x=e.pageX,I.y=e.pageY,!1}function a(e){if(Y)return void b.css("cursor",E.crosshair);if(e.preventDefault(),A.dragEnable){if(!D)return void f({x:e.pageX,y:e.pageY},_);switch(R){case E.m:F.left=_.left+(e.pageX-I.x),F.top=_.top+(e.pageY-I.y),F.width=_.width,F.height=_.height;break;case E.l:F.left=_.left+(e.pageX-I.x),F.top=_.top,F.width=_.width-(e.pageX-I.x),F.height=_.height;break;case E.r:F.left=_.left,F.top=_.top,F.width=_.width+(e.pageX-I.x),F.height=_.height;break;case E.u:F.left=_.left,F.top=_.top+(e.pageY-I.y),F.width=_.width,F.height=_.height-(e.pageY-I.y);break;case E.d:F.left=_.left,F.top=_.top,F.width=_.width,F.height=_.height+(e.pageY-I.y);break;case E.lu:F.left=_.left+(e.pageX-I.x),F.top=_.top+(e.pageY-I.y),F.width=_.width-(e.pageX-I.x),F.height=_.height-(e.pageY-I.y);break;case E.ld:F.left=_.left+(e.pageX-I.x),F.top=_.top,F.width=_.width-(e.pageX-I.x),F.height=_.height+(e.pageY-I.y);break;case E.ru:F.left=_.left,F.top=_.top+(e.pageY-I.y),F.width=_.width+(e.pageX-I.x),F.height=_.height-(e.pageY-I.y);break;case E.rd:F.left=_.left,F.top=_.top,F.width=_.width+(e.pageX-I.x),F.height=_.height+(e.pageY-I.y)}s(),d()}return!1}function h(e){if(Y=!1,!b||0==b.width()||0==b.height())return y.hide(),S.hide(),b&&b.remove(),void clearInterval(C);var t=x.offset();k={left:b.offset().left-t.left,top:b.offset().top-t.top,width:b.width(),height:b.height()},D&&(D=!1,_.left=F.left,_.top=F.top,_.width=F.width,_.height=F.height),$("body").css("cursor",E["default"])}function s(){var e,t;b&&b.remove(),b=$("<div>").appendTo("body").attr("id","drag_box").addClass("default-drag-box dashed-box").css(A.dragBoxCSS),b.mousemove(a),b.mousedown(i),Y&&(e=p(_.width,_.height,A.whRatio),_.width=e.w,_.height=e.h,t=_),D&&(e=p(F.width,F.height,A.whRatio),F.width=e.w,F.height=e.h,t=F),b.css({left:t.left,top:t.top,width:t.width,height:t.height}).css("zIndex",10),r(b)}function d(){if(A.previewEnable){zoom=1,n(),A.fixRatio&&(Y&&(zoom=_.width/S.width()),D&&(zoom=F.width/S.width()));var e=x.width()/zoom,t=x.height()/zoom,o=x.position().left,i=x.position().top,a=b.position().left,h=b.position().top,s=(o-a)/zoom,d=(i-h)/zoom;z.css({width:e,height:t,marginLeft:s,marginTop:d})}}function r(e){return A.flowEnable?void(e.hasClass("dashed-box")&&(e.removeClass("dashed-box"),$("<div>").appendTo(e).addClass("dashed-top"),$("<div>").appendTo(e).addClass("dashed-left"),$("<div>").appendTo(e).addClass("dashed-bottom").css("top",e.height()-2),$("<div>").appendTo(e).addClass("dashed-right").css("left",e.width()-2),clearInterval(C),C=setInterval(function(){var e=$(".dashed-top").css("left"),t=$(".dashed-bottom").css("left");e=parseInt(e),t=parseInt(t),e<0?e+=2:e=-1400,t>-1e3?t-=2:t=0,$(".dashed-top").css("left",e+"px"),$(".dashed-right").css("top",e+"px"),$(".dashed-bottom").css("left",t+"px"),$(".dashed-left").css("top",t+"px")},60))):(clearInterval(C),e.addClass("dashed-box"),$(".dashed-top").remove(),$(".dashed-left").remove(),$(".dashed-bottom").remove(),void $(".dashed-right").remove())}function p(e,t,o){var i=e,a=t;return A.fixRatio&&(o=o instanceof Array?2==o.length?parseFloat(o[0])/(parseFloat(o[1])||1)||1:parseFloat(o[0])||1:parseFloat(o)||1,e/t<o?(i=t*o,a=t):(a=e/o,i=e)),{w:i,h:a}}function n(e,t,o){if(X){e="undefined"!=typeof e?e:A.previewCSS.width,t="undefined"!=typeof t?t:A.previewCSS.height,o="undefined"!=typeof o?o:A.whRatio,o=o instanceof Array?2==o.length?parseFloat(o[0])/(parseFloat(o[1])||1)||1:parseFloat(o[0])||1:parseFloat(o)||1;var i=e,a=t;o>=1?(a=e/o,i=e):(i=t*o,a=t),S.css({width:i,height:a})}}function l(e){X=e,S=$("#"+X).addClass("default-preview-box").css(A.previewCSS),n(),z=$("<img>").appendTo("#"+X).attr("id","preview_box").attr("src",image),A.previewEnable||S.hide()}function f(e,t){var o=10,i=[t.left,t.top,t.left+t.width,t.top+t.height];R=E.m,g(e.x,i[0],i[0]+o)&&g(e.y,i[1]+o,i[3]-o)&&(R=E.l),g(e.x,i[2],i[2]-o)&&g(e.y,i[1]+o,i[3]-o)&&(R=E.r),g(e.x,i[2]-o,i[0]+o)&&g(e.y,i[1],i[1]+o)&&(R=E.u),g(e.x,i[2]-o,i[0]+o)&&g(e.y,i[3],i[3]-o)&&(R=E.d),g(e.x,i[0],i[0]+o)&&g(e.y,i[1],i[1]+o)&&(R=E.lu),g(e.x,i[0],i[0]+o)&&g(e.y,i[3],i[3]-o)&&(R=E.ld),g(e.x,i[2],i[2]-o)&&g(e.y,i[1],i[1]+o)&&(R=E.ru),g(e.x,i[2],i[2]-o)&&g(e.y,i[3],i[3]-o)&&(R=E.rd),b.css("cursor",R)}function g(e,t,o){return e<=t&&e>=o||e<=o&&e>=t}function w(){}function u(){w()}function c(){b.remove(),y.remove(),b=null,y=null}function v(){return k}function m(){c()}var x,b,y,C,z,S,X=null,Y=!1,D=!1,k={left:0,top:0,width:0,height:0},_={left:0,width:0,top:0,height:0},E={"default":"auto",crosshair:"crosshair",m:"move",l:"w-resize",r:"e-resize",u:"n-resize",d:"s-resize",lu:"nw-resize",ld:"sw-resize",ru:"ne-resize",rd:"se-resize"},R=E["default"],F={},I={},T={color:{red:"#ff0000",blue:"#0000ff",green:"#00ff00",gray:"#eeeeee"},opacity:{no:0,low:.2,mid:.5,high:.8,full:1}},A={dragBoxCSS:{},maskEnable:!0,maskCSS:{},dragEnable:!0,previewEnable:!0,previewCSS:{width:200,height:200},fixRatio:!1,whRatio:[2,1],flowEnable:!0};return{init:e,initPreview:l,config:A,option:T,setPreDivRect:n,crop:v,cancel:m,refresh:u}}()}(this);