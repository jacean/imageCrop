!function(t,e,a){function i(t,a,i,o){e("<div>").appendTo(t).addClass("corner-box").css({left:a-2,top:i-1,cursor:o})}function o(t,e,a){return t<=e&&t>=a||t<=a&&t>=e}function r(t){var i=t instanceof jQuery?t:e(t),o={};return i.hasClass("jcrop-main")&&(o.main=i),(i.hasClass("jcrop-img")||i.hasClass("jcrop-mask")||i.hasClass("jcrop-db")||i.hasClass("corner-box"))&&(o.main=i.parent(".jcrop-main")),o.main!=a&&(o.current=i,o.img=o.main.children(".jcrop-img"),o.preMain=o.main.children(".jcrop-pre-main"),o.preImg=o.main.children(".jcrop-pre-img"),o.mask=o.main.children(".jcrop-mask"),o.db=o.main.children(".jcrop-db"),o.corner=o.main.children(".corner-box"),o)}var d={"default":"auto",crosshair:"crosshair",m:"move",l:"w-resize",r:"e-resize",u:"n-resize",d:"s-resize",lu:"nw-resize",ld:"sw-resize",ru:"ne-resize",rd:"se-resize"},p={dragBoxCSS:{},maskEnable:!0,maskCSS:{},dragEnable:!0,previewEnable:!1,previewCSS:{width:200,height:200},fixRatio:!1,whRatio:[2,1],flowEnable:!0,border:5},h=e.extend({},p),s={checkCropRatio:function(t,e,a){var i=t,o=e;return h.fixRatio&&(a=a instanceof Array?2==a.length?parseFloat(a[0])/(parseFloat(a[1])||1)||1:parseFloat(a[0])||1:parseFloat(a)||1,t/e<a?(i=e*a,o=e):(o=t/a,i=t)),{w:i,h:o}},checkPreDivRatio:function(t,e,a){if(previewId){t="undefined"!=typeof t?t:h.previewCSS.width,e="undefined"!=typeof e?e:h.previewCSS.height,a="undefined"!=typeof a?a:h.whRatio,a=a instanceof Array?2==a.length?parseFloat(a[0])/(parseFloat(a[1])||1)||1:parseFloat(a[0])||1:parseFloat(a)||1;var i=t,o=e;return a>=1?(o=t/a,i=t):(i=e*a,o=e),{width:i,height:o}}}},n={mousedown:function(t){var e=r(t.target);if(e){t.preventDefault();var a={};a.left=e.db.position().left,a.top=e.db.position().top,a.width=e.db.width(),a.height=e.db.height();var i=g.setCornerCursor({x:t.pageX,y:t.pageY},a,e);return h.dragEnable&&i!=d.crosshair&&i!=d["default"]?(e.main.data("drag-flag",!0),e.main.data("drag-startX",t.pageX),e.main.data("drag-startY",t.pageY),e.main.data("drag-src",{left:e.db.position().left,top:e.db.position().top,width:e.db.width(),height:e.db.height()}),e.main.addClass("dragDom"),!1):(h.maskEnable?(e.mask.css({left:e.img.position().left,top:e.img.position().top,width:e.img.width(),height:e.img.height()}).css("zIndex",5),e.mask.show()):e.mask.hide(),h.previewEnable?e.preMain.show():e.preMain.hide(),e.main.addClass("cropDom"),e.main.data("crop-flag",!0),e.main.data("crop-startX",t.pageX),e.main.data("crop-startY",t.pageY),e.db.hide(),e.corner.hide(),e.db.width(0),e.db.height(0),!1)}},mousemove:function(t){var a=e(t.target);e(".cropDom").length>0&&(a=e(".cropDom")),e(".dragDom").length>0&&(a=e(".dragDom"));var i=r(a);if(i){t.preventDefault();var o={},p={};o.left=i.db.position().left,o.top=i.db.position().top,o.width=i.db.width(),o.height=i.db.height();var n=g.setCornerCursor({x:t.pageX,y:t.pageY},o,i);if(i.main.data("crop-flag")){i.db.show(),i.corner.show(),cropStartX=i.main.data("crop-startX"),cropStartY=i.main.data("crop-startY"),o.left=cropStartX<t.pageX?cropStartX:t.pageX,o.width=Math.abs(cropStartX-t.pageX),o.top=cropStartY<t.pageY?cropStartY:t.pageY,o.height=Math.abs(cropStartY-t.pageY);var l=s.checkCropRatio(o.width,o.height,h.whRatio);return o.width=l.w,o.height=l.h,g.checkArea(o,i.img),g.updatedb(o,i),void g.updatePreview(i)}if(i.main.data("drag-flag")){i.db.show(),i.corner.show();var c=i.main.data("drag-startX"),f=i.main.data("drag-startY");switch(o=i.main.data("drag-src"),n){case d.m:p.left=o.left+(t.pageX-c),p.top=o.top+(t.pageY-f),p.width=o.width,p.height=o.height;break;case d.l:p.left=t.pageX>o.left+o.width?o.left+o.width:t.pageX,p.top=o.top,p.width=Math.abs(t.pageX-(o.left+o.width)),p.height=o.height;break;case d.r:p.left=t.pageX>o.left?o.left:t.pageX,p.top=o.top,p.width=Math.abs(t.pageX-o.left),p.height=o.height;break;case d.u:p.left=o.left,p.top=t.pageY>o.top+o.height?o.top+o.height:t.pageY,p.width=o.width,p.height=Math.abs(t.pageY-(o.top+o.height));break;case d.d:p.left=o.left,p.top=t.pageY>o.top?o.top:t.pageY,p.width=o.width,p.height=Math.abs(t.pageY-o.top);break;case d.lu:p.left=t.pageX>o.left+o.width?o.left+o.width:t.pageX,p.top=t.pageY>o.top+o.height?o.top+o.height:t.pageY,p.width=Math.abs(t.pageX-(o.left+o.width)),p.height=Math.abs(t.pageY-(o.top+o.height));break;case d.ld:p.left=t.pageX>o.left+o.width?o.left+o.width:t.pageX,p.top=t.pageY>o.top?o.top:t.pageY,p.width=Math.abs(t.pageX-(o.left+o.width)),p.height=Math.abs(t.pageY-o.top);break;case d.ru:p.left=t.pageX>o.left?o.left:t.pageX,p.top=t.pageY>o.top+o.height?o.top+o.height:t.pageY,p.width=Math.abs(t.pageX-o.left),p.height=Math.abs(t.pageY-(o.top+o.height));break;case d.rd:p.left=t.pageX>o.left?o.left:t.pageX,p.top=t.pageY>o.top?o.top:t.pageY,p.width=Math.abs(t.pageX-o.left),p.height=Math.abs(t.pageY-o.top)}return g.checkArea(p,i.img),g.updatedb(p,i),void g.updatePreview(i)}}},mouseup:function(t){var a=e(t.target);e(".cropDom").length>0&&(a=e(".cropDom")),e(".dragDom").length>0&&(a=e(".dragDom"));var i=r(a);if(i){if(i.main.data("crop-flag")&&(i.main.data("crop-flag",!1),i.main.removeClass("cropDom"),i.db&&0!=i.db.width()&&0!=i.db.height()||(i.mask.hide(),i.preMain.hide(),i.db.hide(),i.corner.hide())),i.main.data("drag-flag")){i.main.data("drag-flag",!1),i.main.removeClass("dragDom");var o={};o.left=i.db.position().left,o.top=i.db.position().top,o.width=i.db.width(),o.height=i.db.height(),g.setCornerCursor({x:t.pageX,y:t.pageY},o,i)}g.setCornerBox(i)}}},g={checkArea:function(t,e){var a={left:e.position().left,top:e.position().top,width:e.width(),height:e.height()};t.left>a.left?(t.left+t.width>a.left+a.width&&(t.width=a.left+a.width-t.left),t.left>a.left+a.width&&(t.left=a.left+a.width,t.width=0)):(t.width=t.width-(a.left-t.left),t.left=a.left),t.top>a.top?(t.top+t.height>a.top+a.height&&(t.height=a.top+a.height-t.top),t.top>a.top+a.height&&(t.top=a.top+a.height,t.height=0)):(t.height=t.height-(a.top-t.top),t.top=a.top)},updatedb:function(t,e){var a={};if(e.main.data("crop-flag")||e.main.data("drag-flag")){a=s.checkCropRatio(t.width,t.height,h.whRatio),t.width=a.w,t.height=a.h,e.db.css({left:t.left,top:t.top,width:t.width,height:t.height}).css("zIndex",10),g.setCornerBox(e);var i=e.img.offset(),o={};o="none"==e.db.css("display")?{left:e.db.offset().left-i.left,top:e.db.offset().top-i.top,width:e.db.width(),height:e.db.height()}:{left:0,top:0,width:0,height:0},e.main.data("crop",o)}},updatePreview:function(t){if(h.previewEnable){zoom=1,t.preMain.css(s.checkPreDivRatio()),h.fixRatio&&(t.main.data("crop-flag")&&(zoom=crop_coord.width/t.preMain.width()),t.main.data("drag-flag")&&(zoom=drag_coord.width/t.preMain.width()));var e=t.img.width()/zoom,a=t.img.height()/zoom,i=t.img.position().left,o=t.img.position().top,r=t.db.position().left,d=t.db.position().top,p=(i-r)/zoom,n=(o-d)/zoom;t.preImg.css({width:e,height:a,marginLeft:p,marginTop:n})}},setCornerBox:function(t){if("none"!=t.db.css("display")){var a=t.db;return t.main.children(".corner-box").remove(),i(t.main,a.position().left-h.border/2,a.position().top-h.border/2,d.lu),i(t.main,a.position().left+a.width()/2-h.border/2,a.position().top-h.border/2,d.u),i(t.main,a.position().left+a.width()-h.border/2,a.position().top-h.border/2,d.ru),i(t.main,a.position().left-h.border/2,a.position().top+a.height()/2-h.border/2,d.l),i(t.main,a.position().left+a.width()-h.border/2,a.position().top+a.height()/2-h.border/2,d.r),i(t.main,a.position().left-h.border/2,a.position().top+a.height()-h.border,d.ld),i(t.main,a.position().left+a.width()/2-h.border/2,a.position().top+a.height()-h.border,d.d),i(t.main,a.position().left+a.width()-h.border/2,a.position().top+a.height()-h.border,d.rd),t.corner=t.main.children(".corner-box"),h.dragEnable?t.corner.show():t.corner.hide(),t.db.removeClass("dashed-box"),t.db.children(".dashed-top").remove(),t.db.children(".dashed-left").remove(),t.db.children(".dashed-bottom").remove(),t.db.children(".dashed-right").remove(),h.flowEnable?(e("<div>").appendTo(t.db).addClass("dashed-top").css("top",0),e("<div>").appendTo(t.db).addClass("dashed-left").css("left",0),e("<div>").appendTo(t.db).addClass("dashed-bottom").css("top",t.db.height()-2),e("<div>").appendTo(t.db).addClass("dashed-right").css("left",t.db.width()-2),void 0):void t.db.addClass("dashed-box")}},setCornerCursor:function(t,e,a){if(a.main.data("drag-flag"))return a.db.css("cursor");var i=h.border,r=[e.left,e.top,e.left+e.width,e.top+e.height],p=d.crosshair;return o(t.x,r[0]+i,r[2]-i)&&o(t.y,r[1]+i,r[3]-i)&&(p=h.dragEnable?d.m:d["default"]),h.dragEnable&&(o(t.x,r[0]-i,r[0]+i)&&o(t.y,r[1]+i,r[3]-i)&&(p=d.l),o(t.x,r[2]+i,r[2]-i)&&o(t.y,r[1]+i,r[3]-i)&&(p=d.r),o(t.x,r[2]-i,r[0]+i)&&o(t.y,r[1]-i,r[1]+i)&&(p=d.u),o(t.x,r[2]-i,r[0]+i)&&o(t.y,r[3]+i,r[3]-i)&&(p=d.d),o(t.x,r[0]-i,r[0]+i)&&o(t.y,r[1]-i,r[1]+i)&&(p=d.lu),o(t.x,r[0]-i,r[0]+i)&&o(t.y,r[3]+i,r[3]-i)&&(p=d.ld),o(t.x,r[2]+i,r[2]-i)&&o(t.y,r[1]-i,r[1]+i)&&(p=d.ru),o(t.x,r[2]+i,r[2]-i)&&o(t.y,r[3]+i,r[3]-i)&&(p=d.rd)),a.db&&a.db.css("cursor",p),a.img.css("cursor",p),a.mask.css("cursor",p),p}},l=function(){function t(t,i){var r={};r.main=e(this).addClass("jcrop-main"),r.img=e("<img>").appendTo(r.main).attr("src",t).addClass("jcrop-img"),i!=a&&(h.previewEnable=!0,o=i,r.preMain=e("<div>").appendTo(r.main).addClass("default-preview-box").css(h.previewCSS).addClass("jcrop-pre-main").hide(),r.preImg=e("<img>").appendTo(r.preMain).attr("src",t).addClass("jcrop-pre-img").hide()),r.db=e("<div>").appendTo(r.main).addClass("default-drag-box dashed-box").css(h.dragBoxCSS).addClass("jcrop-db").hide(),r.mask=e("<div>").appendTo(r.main).addClass("default-mask-box").css(h.maskCSS).addClass("jcrop-mask").hide()}function i(){$doms.remove(),e(window).unbind(".jcrop")}var o=null,r={init:t,crop:function(){return crops.result},config:function(t){h=e.extend({},p,t)},destroy:i,onResize:function(){},onMove:function(){}};return r};e.fn.jCrop=function(t){var a=arguments,i=new l;"string"==typeof t&&(e(window).bind("mousedown.jcrop",n.mousedown),e(window).bind("mousemove.jcrop",n.mousemove),e(window).bind("mouseup.jcrop",n.mouseup),flowInter=setInterval(function(){var t=e(".dashed-top").css("left"),a=e(".dashed-bottom").css("left");t=parseInt(t),a=parseInt(a),t<0?t+=2:t=-1400,a>-1e3?a-=2:a=0,e(".dashed-top").css("left",t+"px"),e(".dashed-right").css("top",t+"px"),e(".dashed-bottom").css("left",a+"px"),e(".dashed-left").css("top",a+"px")},60)),this.each(function(){return i[t]?i[t].apply(this,Array.prototype.slice.call(a,1)):"string"==typeof t?i.init.apply(this,a):"object"==typeof t?i.config.apply(this,a):void e.error("Method "+t+" does not exist on jQuery.jCrop")})}}(this,jQuery);