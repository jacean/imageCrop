!function(e){e.jCrop=function(){function e(e,i,h){x=$("#"+e),x.attr("src",i),void 0!=h&&(S=h,A.previewEnable=!0,f(S),z.hide()),Y=$("<div>").appendTo("body").attr("id","mask_box").addClass("default-mask-box").css(A.maskCSS),Y.css("cursor",_.crosshair),x.css("cursor",_.crosshair),x.mousedown(t),Y.mousedown(t),$(window).mousemove(o),$(window).mouseup(a)}function t(e){return A.maskEnable?(Y.css({left:x.position().left,top:x.position().top,width:x.width(),height:x.height()}).css("zIndex",5),Y.show()):Y.hide(),void 0!=z&&z.hide(),A.previewEnable?z.show():z.hide(),void 0!=X&&(X.remove(),X=null),k=!0,e.preventDefault(),k=!0,mouseDown_left=e.pageX,mouseDown_top=e.pageY,D.left=mouseDown_left,D.width=0,D.top=mouseDown_top,D.height=0,!1}function o(e){if(k){D.left=mouseDown_left<e.pageX?mouseDown_left:e.pageX,D.width=Math.abs(mouseDown_left-e.pageX),D.top=mouseDown_top<e.pageY?mouseDown_top:e.pageY,D.height=Math.abs(mouseDown_top-e.pageY);var t=l(D.width,D.height,A.whRatio);D.width=t.w,D.height=t.h,i(D),p(),s()}else if(E){switch(R){case _.m:T.left=D.left+(e.pageX-F.x),T.top=D.top+(e.pageY-F.y),T.width=D.width,T.height=D.height;break;case _.l:T.left=e.pageX>D.left+D.width?D.left+D.width:e.pageX,T.top=D.top,T.width=Math.abs(e.pageX-(D.left+D.width)),T.height=D.height;break;case _.r:T.left=e.pageX>D.left?D.left:e.pageX,T.top=D.top,T.width=Math.abs(e.pageX-D.left),T.height=D.height;break;case _.u:T.left=D.left,T.top=e.pageY>D.top+D.height?D.top+D.height:e.pageY,T.width=D.width,T.height=Math.abs(e.pageY-(D.top+D.height));break;case _.d:T.left=D.left,T.top=e.pageY>D.top?D.top:e.pageY,T.width=D.width,T.height=Math.abs(e.pageY-D.top);break;case _.lu:T.left=e.pageX>D.left+D.width?D.left+D.width:e.pageX,T.top=e.pageY>D.top+D.height?D.top+D.height:e.pageY,T.width=Math.abs(e.pageX-(D.left+D.width)),T.height=Math.abs(e.pageY-(D.top+D.height));break;case _.ld:T.left=e.pageX>D.left+D.width?D.left+D.width:e.pageX,T.top=e.pageY>D.top?D.top:e.pageY,T.width=Math.abs(e.pageX-(D.left+D.width)),T.height=Math.abs(e.pageY-D.top);break;case _.ru:T.left=e.pageX>D.left?D.left:e.pageX,T.top=e.pageY>D.top+D.height?D.top+D.height:e.pageY,T.width=Math.abs(e.pageX-D.left),T.height=Math.abs(e.pageY-(D.top+D.height));break;case _.rd:T.left=e.pageX>D.left?D.left:e.pageX,T.top=e.pageY>D.top?D.top:e.pageY,T.width=Math.abs(e.pageX-D.left),T.height=Math.abs(e.pageY-D.top)}i(T),p(),s()}else g({x:e.pageX,y:e.pageY},D)}function i(e){var t={left:x.position().left,top:x.position().top,width:x.width(),height:x.height()};e.left>t.left?(e.left+e.width>t.left+t.width&&(e.width=t.left+t.width-e.left),e.left>t.left+t.width&&(e.left=t.left+t.width,e.width=0)):(e.width=e.width-(t.left-e.left),e.left=t.left),e.top>t.top?(e.top+e.height>t.top+t.height&&(e.height=t.top+t.height-e.top),e.top>t.top+t.height&&(e.top=t.top+t.height,e.height=0)):(e.height=e.height-(t.top-e.top),e.top=t.top)}function h(e){return e.preventDefault(),A.dragEnable&&(E=!0,F.x=e.pageX,F.y=e.pageY),!1}function a(e){if(k&&(k=!1,X&&0!=X.width()&&0!=X.height()||(Y.hide(),z.hide(),X&&(X.remove(),X=null),clearInterval(y))),E){E=!1;var t=x.offset();M={left:X.offset().left-t.left,top:X.offset().top-t.top,width:X.width(),height:X.height()},D.left=T.left,D.top=T.top,D.width=T.width,D.height=T.height,g({x:e.pageX,y:e.pageY},D)}r(X)}function p(){var e,t;X&&X.remove(),X=$("<div>").appendTo("body").attr("id","drag_box").addClass("default-drag-box dashed-box").css(A.dragBoxCSS),X.mousemove(o),X.mousedown(h),k&&(e=l(D.width,D.height,A.whRatio),D.width=e.w,D.height=e.h,t=D),E&&(e=l(T.width,T.height,A.whRatio),T.width=e.w,T.height=e.h,t=T),X.css({left:t.left,top:t.top,width:t.width,height:t.height}).css("zIndex",10),r(X)}function s(){if(A.previewEnable){zoom=1,n(),A.fixRatio&&(k&&(zoom=D.width/z.width()),E&&(zoom=T.width/z.width()));var e=x.width()/zoom,t=x.height()/zoom,o=x.position().left,i=x.position().top,h=X.position().left,a=X.position().top,p=(o-h)/zoom,s=(i-a)/zoom;C.css({width:e,height:t,marginLeft:p,marginTop:s})}}function d(e,t){$("<div>").appendTo("body").addClass("corner-box").css({left:e-2,top:t-1})}function r(e){if($(".corner-box").remove(),e)return A.dragEnable&&(d(e.position().left-A.border/2,e.position().top-A.border/2),d(e.position().left+e.width()/2-A.border/2,e.position().top-A.border/2),d(e.position().left+e.width()-A.border/2,e.position().top-A.border/2),d(e.position().left-A.border/2,e.position().top+e.height()/2-A.border/2),d(e.position().left+e.width()-A.border/2,e.position().top+e.height()/2-A.border/2),d(e.position().left-A.border/2,e.position().top+e.height()-A.border),d(e.position().left+e.width()/2-A.border/2,e.position().top+e.height()-A.border),d(e.position().left+e.width()-A.border/2,e.position().top+e.height()-A.border)),A.flowEnable?void(e.hasClass("dashed-box")&&(e.removeClass("dashed-box"),$("<div>").appendTo(e).addClass("dashed-top").css("top",0),$("<div>").appendTo(e).addClass("dashed-left").css("left",0),$("<div>").appendTo(e).addClass("dashed-bottom").css("top",e.height()-2),$("<div>").appendTo(e).addClass("dashed-right").css("left",e.width()-2),clearInterval(y),y=setInterval(function(){var e=$(".dashed-top").css("left"),t=$(".dashed-bottom").css("left");e=parseInt(e),t=parseInt(t),e<0?e+=2:e=-1400,t>-1e3?t-=2:t=0,$(".dashed-top").css("left",e+"px"),$(".dashed-right").css("top",e+"px"),$(".dashed-bottom").css("left",t+"px"),$(".dashed-left").css("top",t+"px")},60))):(clearInterval(y),e.addClass("dashed-box"),$(".dashed-top").remove(),$(".dashed-left").remove(),$(".dashed-bottom").remove(),void $(".dashed-right").remove())}function l(e,t,o){var i=e,h=t;return A.fixRatio&&(o=o instanceof Array?2==o.length?parseFloat(o[0])/(parseFloat(o[1])||1)||1:parseFloat(o[0])||1:parseFloat(o)||1,e/t<o?(i=t*o,h=t):(h=e/o,i=e)),{w:i,h:h}}function n(e,t,o){if(S){e="undefined"!=typeof e?e:A.previewCSS.width,t="undefined"!=typeof t?t:A.previewCSS.height,o="undefined"!=typeof o?o:A.whRatio,o=o instanceof Array?2==o.length?parseFloat(o[0])/(parseFloat(o[1])||1)||1:parseFloat(o[0])||1:parseFloat(o)||1;var i=e,h=t;o>=1?(h=e/o,i=e):(i=t*o,h=t),z.css({width:i,height:h})}}function f(e){S=e,z=$("#"+S).addClass("default-preview-box").css(A.previewCSS),n(),C=$("<img>").appendTo("#"+S).attr("id","preview_box").attr("src",image),A.previewEnable||z.hide()}function g(e,t){if(!E&&X){var o=A.border,i=[t.left,t.top,t.left+t.width,t.top+t.height];R=_.crosshair,w(e.x,i[0]+o,i[2]-o)&&w(e.y,i[1]+o,i[3]-o)&&(R=A.dragEnable?_.m:_["default"]),A.dragEnable&&(w(e.x,i[0],i[0]+o)&&w(e.y,i[1]+o,i[3]-o)&&(R=_.l),w(e.x,i[2],i[2]-o)&&w(e.y,i[1]+o,i[3]-o)&&(R=_.r),w(e.x,i[2]-o,i[0]+o)&&w(e.y,i[1],i[1]+o)&&(R=_.u),w(e.x,i[2]-o,i[0]+o)&&w(e.y,i[3],i[3]-o)&&(R=_.d),w(e.x,i[0],i[0]+o)&&w(e.y,i[1],i[1]+o)&&(R=_.lu),w(e.x,i[0],i[0]+o)&&w(e.y,i[3],i[3]-o)&&(R=_.ld),w(e.x,i[2],i[2]-o)&&w(e.y,i[1],i[1]+o)&&(R=_.ru),w(e.x,i[2],i[2]-o)&&w(e.y,i[3],i[3]-o)&&(R=_.rd)),X.css("cursor",R),x.css("cursor",R),Y.css("cursor",R)}}function w(e,t,o){return e<=t&&e>=o||e<=o&&e>=t}function c(){}function u(){c()}function b(){X.remove(),Y.remove(),X=null,Y=null}function m(){return M}function v(){b()}var x,X,Y,y,C,z,S=null,k=!1,E=!1,M={left:0,top:0,width:0,height:0},D={left:0,width:0,top:0,height:0},_={"default":"auto",crosshair:"crosshair",m:"move",l:"w-resize",r:"e-resize",u:"n-resize",d:"s-resize",lu:"nw-resize",ld:"sw-resize",ru:"ne-resize",rd:"se-resize"},R=_["default"],T={},F={},I={color:{red:"#ff0000",blue:"#0000ff",green:"#00ff00",gray:"#eeeeee"},opacity:{no:0,low:.2,mid:.5,high:.8,full:1}},A={dragBoxCSS:{},maskEnable:!0,maskCSS:{},dragEnable:!0,previewEnable:!0,previewCSS:{width:200,height:200},fixRatio:!1,whRatio:[2,1],flowEnable:!0,border:5};return{init:e,initPreview:f,config:A,option:I,setPreDivRect:n,crop:m,cancel:v,refresh:u}}()}(this);