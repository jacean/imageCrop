!function(e){e.jCrop=function(){function e(e,o,h){v=$("#"+e),v.attr("src",o),void 0!=h&&(C=h,I.previewEnable=!0,l(C),y.hide()),v.mousedown(t),v.mousemove(a),x=$("<div>").appendTo("body").attr("id","mask_box").addClass("default-mask-box").css(I.maskCSS),x.mousedown(t),x.mousemove(a),x.css("cursor",M.crosshair),v.css("cursor",M.crosshair),$(window).mouseup(i)}function t(e){return I.maskEnable?(x.css({left:v.position().left,top:v.position().top,width:v.width(),height:v.height()}).css("zIndex",5),x.show()):x.hide(),void 0!=y&&y.hide(),I.previewEnable?y.show():y.hide(),void 0!=b&&(b.remove(),b=null),z=!0,e.preventDefault(),z=!0,mouseDown_left=e.pageX,mouseDown_top=e.pageY,D.left=mouseDown_left,D.width=0,D.top=mouseDown_top,D.height=0,!1}function a(e){if(z){e.preventDefault(),D.left=mouseDown_left<e.pageX?mouseDown_left:e.pageX,D.width=Math.abs(mouseDown_left-e.pageX),D.top=mouseDown_top<e.pageY?mouseDown_top:e.pageY,D.height=Math.abs(mouseDown_top-e.pageY);var t=p(D.width,D.height,I.whRatio);D.width=t.w,D.height=t.h,h(),s()}else if(S){switch(E){case M.m:_.left=D.left+(e.pageX-R.x),_.top=D.top+(e.pageY-R.y),_.width=D.width,_.height=D.height;break;case M.l:_.left=e.pageX>D.left+D.width?D.left+D.width:e.pageX,_.top=D.top,_.width=Math.abs(e.pageX-(D.left+D.width)),_.height=D.height;break;case M.r:_.left=e.pageX>D.left?D.left:e.pageX,_.top=D.top,_.width=Math.abs(e.pageX-D.left),_.height=D.height;break;case M.u:_.left=D.left,_.top=e.pageY>D.top+D.height?D.top+D.height:e.pageY,_.width=D.width,_.height=Math.abs(e.pageY-(D.top+D.height));break;case M.d:_.left=D.left,_.top=e.pageY>D.top?D.top:e.pageY,_.width=D.width,_.height=Math.abs(e.pageY-D.top);break;case M.lu:_.left=e.pageX>D.left+D.width?D.left+D.width:e.pageX,_.top=e.pageY>D.top+D.height?D.top+D.height:e.pageY,_.width=Math.abs(e.pageX-(D.left+D.width)),_.height=Math.abs(e.pageY-(D.top+D.height));break;case M.ld:_.left=e.pageX>D.left+D.width?D.left+D.width:e.pageX,_.top=e.pageY>D.top?D.top:e.pageY,_.width=Math.abs(e.pageX-(D.left+D.width)),_.height=Math.abs(e.pageY-D.top);break;case M.ru:_.left=e.pageX>D.left?D.left:e.pageX,_.top=e.pageY>D.top+D.height?D.top+D.height:e.pageY,_.width=Math.abs(e.pageX-D.left),_.height=Math.abs(e.pageY-(D.top+D.height));break;case M.rd:_.left=e.pageX>D.left?D.left:e.pageX,_.top=e.pageY>D.top?D.top:e.pageY,_.width=Math.abs(e.pageX-D.left),_.height=Math.abs(e.pageY-D.top)}h(),s()}else n({x:e.pageX,y:e.pageY},D);return!1}function o(e){return e.preventDefault(),I.dragEnable&&(S=!0,R.x=e.pageX,R.y=e.pageY),!1}function i(e){if(z&&(z=!1,b&&0!=b.width()&&0!=b.height()||(x.hide(),y.hide(),b&&b.remove(),clearInterval(X))),S){S=!1;var t=v.offset();k={"let":b.offset().left-t.left,top:b.offset().top-t.top,width:b.width(),height:b.height()},D.left=_.left,D.top=_.top,D.width=_.width,D.height=_.height,n({x:e.pageX,y:e.pageY},D)}}function h(){var e,t;b&&b.remove(),b=$("<div>").appendTo("body").attr("id","drag_box").addClass("default-drag-box dashed-box").css(I.dragBoxCSS),b.mousemove(a),b.mousedown(o),z&&(e=p(D.width,D.height,I.whRatio),D.width=e.w,D.height=e.h,t=D),S&&(e=p(_.width,_.height,I.whRatio),_.width=e.w,_.height=e.h,t=_),b.css({left:t.left,top:t.top,width:t.width,height:t.height}).css("zIndex",10),d(b)}function s(){if(I.previewEnable){zoom=1,r(),I.fixRatio&&(z&&(zoom=D.width/y.width()),S&&(zoom=_.width/y.width()));var e=v.width()/zoom,t=v.height()/zoom,a=v.position().left,o=v.position().top,i=b.position().left,h=b.position().top,s=(a-i)/zoom,d=(o-h)/zoom;Y.css({width:e,height:t,marginLeft:s,marginTop:d})}}function d(e){return I.flowEnable?void(e.hasClass("dashed-box")&&(e.removeClass("dashed-box"),$("<div>").appendTo(e).addClass("dashed-top"),$("<div>").appendTo(e).addClass("dashed-left"),$("<div>").appendTo(e).addClass("dashed-bottom").css("top",e.height()-2),$("<div>").appendTo(e).addClass("dashed-right").css("left",e.width()-2),clearInterval(X),X=setInterval(function(){var e=$(".dashed-top").css("left"),t=$(".dashed-bottom").css("left");e=parseInt(e),t=parseInt(t),e<0?e+=2:e=-1400,t>-1e3?t-=2:t=0,$(".dashed-top").css("left",e+"px"),$(".dashed-right").css("top",e+"px"),$(".dashed-bottom").css("left",t+"px"),$(".dashed-left").css("top",t+"px")},60))):(clearInterval(X),e.addClass("dashed-box"),$(".dashed-top").remove(),$(".dashed-left").remove(),$(".dashed-bottom").remove(),void $(".dashed-right").remove())}function p(e,t,a){var o=e,i=t;return I.fixRatio&&(a=a instanceof Array?2==a.length?parseFloat(a[0])/(parseFloat(a[1])||1)||1:parseFloat(a[0])||1:parseFloat(a)||1,e/t<a?(o=t*a,i=t):(i=e/a,o=e)),{w:o,h:i}}function r(e,t,a){if(C){e="undefined"!=typeof e?e:I.previewCSS.width,t="undefined"!=typeof t?t:I.previewCSS.height,a="undefined"!=typeof a?a:I.whRatio,a=a instanceof Array?2==a.length?parseFloat(a[0])/(parseFloat(a[1])||1)||1:parseFloat(a[0])||1:parseFloat(a)||1;var o=e,i=t;a>=1?(i=e/a,o=e):(o=t*a,i=t),y.css({width:o,height:i})}}function l(e){C=e,y=$("#"+C).addClass("default-preview-box").css(I.previewCSS),r(),Y=$("<img>").appendTo("#"+C).attr("id","preview_box").attr("src",image),I.previewEnable||y.hide()}function n(e,t){if(!S&&b){var a=10,o=[t.left,t.top,t.left+t.width,t.top+t.height];E=M.crosshair,f(e.x,o[0]+a,o[2]-a)&&f(e.y,o[1]+a,o[3]-a)&&(E=I.dragEnable?M.m:M["default"]),I.dragEnable&&(f(e.x,o[0],o[0]+a)&&f(e.y,o[1]+a,o[3]-a)&&(E=M.l),f(e.x,o[2],o[2]-a)&&f(e.y,o[1]+a,o[3]-a)&&(E=M.r),f(e.x,o[2]-a,o[0]+a)&&f(e.y,o[1],o[1]+a)&&(E=M.u),f(e.x,o[2]-a,o[0]+a)&&f(e.y,o[3],o[3]-a)&&(E=M.d),f(e.x,o[0],o[0]+a)&&f(e.y,o[1],o[1]+a)&&(E=M.lu),f(e.x,o[0],o[0]+a)&&f(e.y,o[3],o[3]-a)&&(E=M.ld),f(e.x,o[2],o[2]-a)&&f(e.y,o[1],o[1]+a)&&(E=M.ru),f(e.x,o[2],o[2]-a)&&f(e.y,o[3],o[3]-a)&&(E=M.rd)),b.css("cursor",E),v.css("cursor",E),x.css("cursor",E)}}function f(e,t,a){return e<=t&&e>=a||e<=a&&e>=t}function g(){}function w(){g()}function u(){b.remove(),x.remove(),b=null,x=null}function c(){return k}function m(){u()}var v,b,x,X,Y,y,C=null,z=!1,S=!1,k={left:0,top:0,width:0,height:0},D={left:0,width:0,top:0,height:0},M={"default":"auto",crosshair:"crosshair",m:"move",l:"w-resize",r:"e-resize",u:"n-resize",d:"s-resize",lu:"nw-resize",ld:"sw-resize",ru:"ne-resize",rd:"se-resize"},E=M["default"],_={},R={},F={color:{red:"#ff0000",blue:"#0000ff",green:"#00ff00",gray:"#eeeeee"},opacity:{no:0,low:.2,mid:.5,high:.8,full:1}},I={dragBoxCSS:{},maskEnable:!0,maskCSS:{},dragEnable:!0,previewEnable:!0,previewCSS:{width:200,height:200},fixRatio:!1,whRatio:[2,1],flowEnable:!0};return{init:e,initPreview:l,config:I,option:F,setPreDivRect:r,crop:c,cancel:m,refresh:w}}()}(this);